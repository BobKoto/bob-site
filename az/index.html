<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Permissions-Policy" content="interest-cohort=(), user-id=()" />
    <meta name="description" content="Arcade game built with Unity and implemented as a PWA (Progressive Web App). Learn.">
    <link rel="manifest" href="azmanifest.json" />
    <link rel = "icon" href="intericon.png" />
   <!-- <link rel = "icon" href="intericon256.png" />   this errors out -->
    <style> 
        .ENTERSTYLE { 
            background-color: white; 
            border: 2px solid black; 
            color: green; 
            padding: 5px 10px; 
            text-align: center; 
            display: inline-block; 
            font-size: 20px; 
            margin: 10px 30px; 
            cursor: pointer; 
        } 
    </style> 
        <style>
          .toggle-section {
              display: block;
              margin: 20px;
              padding: 10px;
              border: 1px solid #ccc;
          }
      </style>
      <style>
        body {
          background-color: lightblue;
        }
  </style>
    <title>Hello PWA</title>
</head>
<body>
    <h1>Intercept Arcade Game</h1>
    <!-- *****The Local VERSION to update***** -->
    <div id="message-container"></div> <p> Local VERSION a064</p><br> <!-- Change the SW too!!!-->
    <h2>Local Time:  <p id="localTime"></p></h2>
   <a href='https://bobkoto.github.io/bob-site/az/game01/index.html'> 
            <button class="ENTERSTYLE"> 
                ****ENTER****
            </button> 
    </a> 
    <br><br>
    <p><strong> That's all for now.</strong></p><br>
   <div class="toggle-section" id="installPromptSection" style="display: none;">  
   <p>You can install this game/page to your device. <br>
    Then you can use it even if you're not connected to the internet.</p>
   <p>     <button id="installButton" style="display: block;"> Ok, Install App </button> <strong> it can be used when not connected to the internet</strong> </p>
   <p>     <button id="notNowButton" style="display: block;" >    Not Now      </button> <strong>  for now use this App connected to the internet</strong> </p>
   </div> 

   <script src="RegisterServiceWorker.js"></script>  
 
  <script>
      function hideInstallPromptSection() {
          var section = document.getElementById('installPromptSection');
          section.style.display = 'none';
          console.log('HIDE PWA install prompt');
      }
  </script>
    <script>
      function showInstallPromptSection() {
          var section = document.getElementById('installPromptSection');
          section.style.display = 'block';
          console.log('SHOW PWA install prompt');
      }
  </script>

    <script>
        // Function to update the displayed time
        function updateTime() {
            var currentTime = new Date();
            var hours = currentTime.getHours();
            var minutes = currentTime.getMinutes();
            var seconds = currentTime.getSeconds();
            // Add leading zero if needed
            hours = (hours < 10 ? "0" : "") + hours;
            minutes = (minutes < 10 ? "0" : "") + minutes;
            seconds = (seconds < 10 ? "0" : "") + seconds;
    
            // Display the time in the "localTime" element
            document.getElementById("localTime").innerHTML = hours + ":" + minutes + ":" + seconds;
        }
        // Call updateTime initially when the page loads or is refreshed
        updateTime();
    </script>

<script>
  let deferredPrompt;
  // Check if the app is already installed (runs when the page loads)
  if (window.matchMedia('(display-mode: standalone)').matches) {
    hideInstallPromptSection();
    console.log('display-mode = standalone so we are in PWA');
   }
  else {
  console.log('display-mode is NOT standalone so we are online and NOT PWA. Proceed with addListener for beforeinstallprompt for PWA');
  window.addEventListener('beforeinstallprompt', (event) => {
    // Prevent the default behavior and Stash the event in deferredPrompt so it can be triggered later.
    event.preventDefault();
    deferredPrompt = event;
    // Show the install button or take any other action  //document.getElementById('installButton').style.display = 'block';
    showInstallPromptSection();
    console.log('the deferred prompt INSIDE the addEventListener block is ', deferredPrompt);
  });
  console.log('the deferred prompt OUTSIDE the addEventListener block is ', deferredPrompt, ' now listen on the installButton');
  document.getElementById('installButton').addEventListener('click', () => {
    // Show the installation prompt
    if (deferredPrompt) {
      deferredPrompt.prompt();
      // Wait for the user to respond to the prompt
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('User accepted the install prompt');
          // Hide the install button after successful installation
          hideInstallPromptSection();
        } else {
          console.log('User dismissed the install prompt');
          hideInstallPromptSection();
         // document.getElementById('notNowButton').style.display = 'none';
        }
        // Reset the deferredPrompt
        deferredPrompt = null;
      });
    }
  });
// Check if the app is already installed (runs when the page loads)
//  if (window.matchMedia('(display-mode: standalone)').matches) {
//    //document.getElementById('installButton').style.display = 'none';
//    hideInstallPromptSection();
  }
</script>

    <script>
    document.getElementById('notNowButton').addEventListener('click', () => {
        console.log('User clicked notNow ');
        hideInstallPromptSection();
      //  <!--document.getElementById('notNowButton').style.display = 'none';
      //  document.getElementById('installButton').style.display = 'none';  -->
      });
      </script>

<!--   <script>
    document.getElementById('enterButton').addEventListener('click', () => {
        console.log('User pressed ****ENTER****');
      });
      </script> -->
</body>

</html>